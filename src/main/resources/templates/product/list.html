<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product list</title>
<!--    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css">-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
    <link rel="stylesheet" href="/assets/v11.7.3/sweetalert2.min.css">
<!--    <link rel="stylesheet" href="/assets/css/preview-image.css">-->
<!--    <link rel="stylesheet" href="/assets/css/custom-style.css">-->
</head>

<body>
<div class="container-fluid">
    <header>
        <nav class="navbar navbar-expand-sm">
            <div class="container-fluid header">
                <a class="navbar-brand" href="javascript:void(0)"> <i class="fas fa-list-ul btn"></i></a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mynavbar">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="mynavbar">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="javascript:void(0)"></a>
                        </li>

                    </ul>
                    <form class="d-flex">
                        <span class="d-flex">
                            <label class="form-label me-2">Type</label>
                            <select name="" id="typeSe" class="custom-select form-control me-2" style="width: 120px;">
                                <option value="">--ALL--</option>
                                <option value="1">MALE</option>
                                <option value="2">FEMALE</option>
                                <option value="3">UNISEX</option>
                            </select>
                        </span>
                        <span class="d-flex" style="">
                            <label class="form-label me-2">Brand</label>
                            <select name="" id="brandSe" class="custom-select form-control me-2" style="width: 120px;">
                                <option value="">--ALL--</option>
                                <option value="1">DIOR</option>
                                <option value="2">CHANEL</option>
                                <option value="3">NAUTICA</option>
                                <option value="4">ROJA DOVE</option>
                                <option value="5">VERSACE</option>
                                <option value="6">CREED</option>
                                <option value="7">YSL</option>
                                <option value="8">LANCOME</option>
                                <option value="9">MOSCHINO</option>
                            </select>
                        </span>
                        <input class="form-control me-2" type="text" placeholder="Search" id="keyword">
                        <button class="btn btn-light" type="button" id="btn_search">Search</button>
                    </form>
                    <button type="button" class="btn position-relative">
                        <i class="fas fa-bell head_item"></i>
                        <span class="position-absolute top-0 start-100 translate-middle p-2 bg-danger border border-light rounded-circle">
                            <span class="visually-hidden">New alerts</span>
                        </span>
                    </button>
                    <button type="button" class="btn position-relative">
                        <i class="fas fa-cog head_item"></i>
                    </button>
                </div>
            </div>
        </nav>
    </header>
    <div class="row">
        <!--side_bar start-->
        <nav class="col col-lg-2 side_bar">
            <div class="side_header">
                <div class="logo rounded-circle" >
                    <img src="/assets/images/logo2.jpg" alt="" style=" width: 130px; height: auto;" class="navbar-brand"></div>
                <div class="head_text">

                    <h4>SILLAGE BONTIQUE</h4>
                    <h6>La vie en rose</h6>
                </div>
                <hr>
                <div class="side_container">
                    <ul>
                        <li><a href="/products"><i class="fas fa-cubes side_item"><span> List Product</span> </i></a></li>
                        <li id="type_block">
                            <a href="#"><i class="fas fa-users side_item type-header" ><span> Product Type</span> </i></a>
                            <ul class="type-list">
                                <li><a href="#"><span class="type-label btn " data-id="1">MALE</span></a></li>
                                <li><a href="#"><span class="type-label btn" data-id="2">FEMALE</span></a></li>
                                <li><a href="#"><span class="type-label btn" data-id="3">UNISEX</span></a></li>
                            </ul>
                        </li>
                        <li id="brand_block">
                            <a href="#"><i class="fas fa-cookie-bite side_item brand-header" ><span> Product Brand</span> </i></a>
                            <ul class="brand-list">
                                <li><a href="#"><span class="brand-label btn" data-id="1">DIOR</span></a></li>
                                <li><a href="#"><span class="brand-label btn" data-id="2">CHANEL</span></a></li>
                                <li><a href="#"><span class="brand-label btn" data-id="3">NAUTICA</span></a></li>
                                <li><a href="#"><span class="brand-label btn" data-id="4">ROJA'DOVE</span></a></li>
                                <li><a href="#"><span class="brand-label btn" data-id="5">VERSACE</span></a></li>
                                <li><a href="#"><span class="brand-label btn" data-id="6">CREED</span></a></li>
                                <li><a href="#"><span class="brand-label btn" data-id="7">YSL</span></a></li>
                                <li><a href="#"><span class="brand-label btn" data-id="8">LANCOME</span></a></li>
                                <li><a href="#"><span class="brand-label btn" data-id="9">MOSCHINO</span></a></li>
                            </ul>
                        </li>
                    </ul>
                    <p style="">
                        Design by Phu Phan
                    </p>
                </div>
            </div>
        </nav>
        <!--end side_bar-->
        <!-- Content -->
        <div class="content col col-lg-10">
            <div class="content_header row clearfix d-flex justify-content-between" style="margin-bottom: 20px">
                <h3 class=" col"> LIST PRODUCT</h3>
                <button class=" btn btn-sm btn-light col-lg-3" id="btnShowCreateModal"><i class="fas fa-plus"> Creat new product</i></button>
            </div>
            <div class="content">
                <table id="tbProduct" class="table table-hover table-light">
                    <thead>
                    <tr >
                        <th>#</th>
                        <th>Image</th>
                        <th>Product name</th>
                        <th>Type</th>
                        <th>Brand</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th colspan="3">Action</th>
                    </tr>

                    </thead>
                    <tbody>


                    </tbody>
                </table>
            </div>

        </div>
        <!-- End Content -->

    </div>
    <footer>
        <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-end">
<!--                <li class="page-item disabled">-->
<!--                    <a class="page-link" href="#" tabindex="-1">Previous</a>-->
<!--                </li>-->
<!--                <li class="page-item"><a class="page-link" href="#">1</a></li>-->
<!--                <li class="page-item"><a class="page-link" href="#">2</a></li>-->
<!--                <li class="page-item"><a class="page-link" href="#">3</a></li>-->
<!--                <li class="page-item">-->
<!--                    <a class="page-link" href="#">Next</a>-->
<!--                </li>-->
            </ul>
        </nav>

    </footer>

</div>

<th:block th:replace="product/modal_create" />
<th:block th:replace="product/modal_update_avatar" />


<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        background-color: rgb(221, 237, 247);

    }

    .header {
        padding: 16px;
    }

    .head_text {
        padding: 8px 0;
    }

    .side_bar {
        background-color: rgb(170, 95, 141);
        color: #ffff;
        border-radius: 0 60px 0 60px;
        padding: 10px;
        text-align: center;
        /*margin-right: 8px;*/

    }

    .side_container>ul>li {
        padding: 10px;
        color: #ffff;
        text-align: left;
        border-radius: 8px;
        list-style-type: none;
    }

    .side_container>ul>li:hover {
        opacity: 0.7;
        background-color: rgb(212, 202, 209);


    }
    .logo{
        margin-top: 30px;
    }

    .side_container>ul>li>a,
    .type-label,
    .brand-label{
        color: #ffff;
    }
    /*.type-label{*/
    /*    display: none;*/
    /*}*/
    .side_container a{
        text-decoration: none;
    }

    #type_block>ul>li{
        list-style-type: none;
    }
    #brand_block>ul>li{
        list-style-type: none;
    }

    .side_item {
        margin-right: 4px;
    }

    .product_img {
        width: 100px;
        height: auto;
    }
    table tr{
        border-radius: 8px;
    }
    .error{
        color:red;
    }
    .page-link-search {
        position: relative;
        display: block;
        padding: var(--bs-pagination-padding-y) var(--bs-pagination-padding-x);
        font-size: var(--bs-pagination-font-size);
        color: var(--bs-pagination-color);
        text-decoration: none;
        background-color: var(--bs-pagination-bg);
        border: var(--bs-pagination-border-width) solid var(--bs-pagination-border-color);
        transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;
    }
</style>

<script src="/assets/jquery/jquery-3.6.0.min.js"></script>
<script src="/assets/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/assets/v11.7.3/sweetalert2.all.min.js"></script>
<script src="/assets/js/AppBase.js"></script>
<script src="/assets/jquery/jquery.validate.min.js"></script>

<script>
    const page = {
        urls: {
            getAllProducts: AppBase.API_PRODUCT,
            getAllByType: AppBase.API_PRODUCT  + "/type",
            getAllByBrand: AppBase.API_PRODUCT  + "/brand",
            getAllByKeyword: AppBase.API_PRODUCT  + "/search?keyword=",
            getProductById: AppBase.API_PRODUCT,
            findCustomerById: AppBase.API_PRODUCT,
            doCreate: AppBase.API_PRODUCT,
            doCreateProductWithAvatar: AppBase.API_PRODUCT ,
            doUpdateWithAvatar: AppBase.API_PRODUCT ,
            deleteProduct:AppBase.API_PRODUCT + "/delete"

        },
        elements: {},
        loadData: {},
        commands: {},
        dialogs: {
            elements: {},
            loadData: {},
            commands: {},
        }
    }
    page.elements.btnShowCreateModal = $('#btnShowCreateModal');

    page.dialogs.elements.modalCreateProduct = $('#modalCreateProduct');
    page.dialogs.elements.frmCreateProduct = $('#frmCreateProduct');
    page.dialogs.elements.titleCre = $('#titleCre');
    page.dialogs.elements.priceCre = $('#PriceCre');
    page.dialogs.elements.descriptionCre = $('#descriptionCre');
    page.dialogs.elements.typeCre = $('#typeCre');
    page.dialogs.elements.brandCre = $('#brandCre');


    page.dialogs.elements.modalUpdateProduct = $('#modalUpdateProduct');
    page.dialogs.elements.frmUpdate = $('#frmUpdateProduct');
    page.dialogs.elements.titleUp = $('#titleUp');
    page.dialogs.elements.priceUp = $('#priceUp');
    page.dialogs.elements.descriptionUp = $('#descriptionUp');
    page.dialogs.elements.quantityUp = $('#quantityUp');
    page.dialogs.elements.typeUp = $('#typeUp');
    page.dialogs.elements.brandUp = $('#brandUp');


    page.dialogs.elements.btnCreateCustomer = $('#btnCreateCustomer');
    page.dialogs.elements.btnUpdateCustomer = $('#btnUpdateCustomer');


    page.dialogs.elements.modalUpdate = $('#modalUpdateProduct');
    page.dialogs.elements.modaldetailCustomer = $('#modalDetail');


    page.dialogs.elements.wrapper = $("section .wrapper");
    page.dialogs.elements.productName = $("#productName");
    page.dialogs.elements.description = $("#description");
    page.dialogs.elements.imageFile = $("#imageFile");
    page.dialogs.elements.wrapperContent = $("section .wrapper .content");
    page.dialogs.elements.imagePreview = $("section .image-preview");
    page.dialogs.elements.imagePreviewCanvas = $("section .image-preview canvas");
    page.dialogs.elements.canvas = $("#canvas");
    page.dialogs.elements.context = page.dialogs.elements.canvas[0].getContext('2d');
    page.dialogs.elements.imagePreviewCanvas.css("display", "none");
    page.dialogs.elements.divImagePreview = $("#modalCreateProduct div.image-preview");
    page.dialogs.elements.divFileName = $("#modalCreateProduct div.file-name");

    page.dialogs.elements.imageFileUp = $("#imageFileUp");
    page.dialogs.elements.imagePreviewCanvasUp = $("section .image-preview #canvasUp");
    page.dialogs.elements.canvasUp = $("#canvasUp");
    page.dialogs.elements.contextUp = page.dialogs.elements.canvasUp[0].getContext('2d');
    page.dialogs.elements.imagePreviewCanvasUp.css("display", "none");

    page.dialogs.elements.divImagePreviewUp = $("#modalUpdateProduct div.image-preview");
    page.dialogs.elements.divFileNameUp = $("#modalUpdateProduct div.file-name");

    // page.dialogs.elements.divImagePreviewUp = $("#modalUpdateProduct div.image-preview");
    // page.dialogs.elements.divFileNameUp = $("#modalUpdateProduct div.file-name");

    page.dialogs.elements.btnClearImagePreview = $(".clear-image-preview i");

    let product = new Product();
    let productAvatar = new ProductAvatar();
    let type = new Type();
    let brand = new Brand();
    let currentPageNumber = 0;
    let currentSearchPageNumber = 0;


    function renderProducts(product, avatar, type, brand) {
        let image_thumbnail = `
                ${AppBase.API_CLOUDINARY}/${AppBase.SCALE_IMAGE_W_80_H_80_Q_100}/${avatar.fileFolder}/${avatar.fileName}
            `;
        return `
                    <tr id="tr_${product.id}">
                        <td>${product.id}</td>
                        <td>
                            <img src="${image_thumbnail}" alt="">
                        </td>
                        <td>${product.title}</td>
                        <td>${type.code}</td>
                        <td>${brand.code}</td>
                        <td>${new Intl.NumberFormat('vi-VN', {style: 'currency', currency: 'VND'}).format(product.price)}</td>
                        <td>${product.quantity}</td>


                        <td>
                            <button class="btn btn-outline-secondary btn_edit" data-id="${product.id}"
                                                                           data-avatar-id = "${avatar.id}"
                                                                           data-avatar-file-folder = "${avatar.fileFolder}"
                                                                           data-avatar-file-name = "${avatar.fileName}">
                                <i class="fas fa-wrench"></i>
                            </button>
                        </td>


                        <td>
                            <button class="btn btn-outline-danger btn_deleted" data-id="${product.id}">
                                <i class="fas fa-cut"></i>
                            </button>
                        </td>
                    </tr>
                `;
    }
    page.loadData.getAllProduct = () => {
        $.ajax({
            type: 'GET',
            url: page.urls.getAllProducts + "?page=" + currentPageNumber,
        })
            .done((data) => {
                $('#tbProduct tbody').empty();
                let products = data.content
                let pageable = data.pageable;
                let totalPages = data.totalPages;
                let str = page.commands.renderPagination(pageable, totalPages);
                $('ul.pagination').empty().append(str);
                $.each(products, (i, item) => {
                    product = item;
                    productAvatar = product.productAvatar;
                    type = product.type;
                    brand = product.brand
                    let str = renderProducts(product, productAvatar, type, brand);
                    $('#tbProduct tbody').prepend(str);
                    page.commands.removeHandleShowModal();
                    page.commands.handleShowGroupModal();
                    page.commands.handleAddEventPageLink();
                    page.commands.handleAddEventSearchPageLink();
                })
            })
            .fail((error) => {
                console.log(error);
            })
    }
    page.loadData.getAllByType = () => {
        $(".type-label").on("click", function (){
            let id = $(this).data("id");
            $.ajax({
                type: 'GET',
                url: page.urls.getAllByType + "/" + id,
            })
                .done((data) => {
                    $('#tbProduct tbody').empty();
                    $.each(data, (i, item) => {
                        product = item;
                        productAvatar = product.productAvatar;
                        type = product.type;
                        brand = product.brand
                        let str = renderProducts(product, productAvatar, type, brand);
                        $('#tbProduct tbody').prepend(str);
                        page.commands.removeHandleShowModal();
                        page.commands.handleShowGroupModal();
                    })
                })
                .fail((error) => {
                    console.log(error);
                })

        })
    }
    page.loadData.getAllByBrand = () => {
        $(".brand-label").on("click", function (){
            let id = $(this).data("id");
            $.ajax({
                type: 'GET',
                url: page.urls.getAllByBrand + "/" + id,
            })
                .done((data) => {
                    $('#tbProduct tbody').empty();
                    $.each(data, (i, item) => {
                        product = item;
                        productAvatar = product.productAvatar;
                        type = product.type;
                        brand = product.brand
                        let str = renderProducts(product, productAvatar, type, brand);
                        $('#tbProduct tbody').prepend(str);
                        page.commands.removeHandleShowModal();
                        page.commands.handleShowGroupModal();
                    })
                })
                .fail((error) => {
                    console.log(error);
                })

        })
    }

    page.loadData.getAllByKeyword = () => {
        $("#btn_search").on("click", function (){
            let keyword = $("#keyword").val();
            let typeId = $("#typeSe").val();
            let brandId = $("#brandSe").val();
            $.ajax({
                type: 'GET',
                url: page.urls.getAllByKeyword  + keyword + "&typeId=" + typeId + "&brandId=" + brandId + "&page=" + currentSearchPageNumber,
            })
                .done((data) => {
                    $('#tbProduct tbody').empty();
                    let products = data.content;
                    let pageable = data.pageable;
                    let totalPages = data.totalPages;
                    let str = page.commands.renderSearchPagination(pageable, totalPages);
                    $('ul.pagination').empty().append(str);
                    $.each(products, (i, item) => {
                        product = item;
                        productAvatar = product.productAvatar;
                        type = product.type;
                        brand = product.brand
                        let str = renderProducts(product, productAvatar, type, brand);
                        $('#tbProduct tbody').prepend(str);
                        page.commands.removeHandleShowModal();
                        page.commands.handleShowGroupModal();
                        page.commands.handleAddEventPageLink();
                        page.commands.handleAddEventSearchPageLink();
                    })
                })
                .fail((error) => {
                    console.log(error);
                })

        })
    }

    page.loadData.getAllByKeywordDontClick = () => {
            let keyword = $("#keyword").val();
            let typeId = $("#typeSe").val();
            let brandId = $("#brandSe").val();
            $.ajax({
                type: 'GET',
                url: page.urls.getAllByKeyword  + keyword + "&typeId=" + typeId + "&brandId=" + brandId + "&page=" + currentSearchPageNumber,
            })
                .done((data) => {
                    $('#tbProduct tbody').empty();
                    let products = data.content;
                    let pageable = data.pageable;
                    let totalPages = data.totalPages;
                    let str = page.commands.renderSearchPagination(pageable, totalPages);
                    $('ul.pagination').empty().append(str);
                    $.each(products, (i, item) => {
                        product = item;
                        productAvatar = product.productAvatar;
                        type = product.type;
                        brand = product.brand
                        let str = renderProducts(product, productAvatar, type, brand);
                        $('#tbProduct tbody').prepend(str);
                        page.commands.removeHandleShowModal();
                        page.commands.handleShowGroupModal();
                        page.commands.handleAddEventPageLink();
                        page.commands.handleAddEventSearchPageLink();
                    })
                })
                .fail((error) => {
                    console.log(error);
                })

    }
    page.dialogs.commands.doCreate = () => {
        let title = page.dialogs.elements.titleCre.val();
        let price = page.dialogs.elements.priceCre.val();
        let description = page.dialogs.elements.descriptionCre.val();
        let typeId = page.dialogs.elements.typeCre.val();
        let brandId = page.dialogs.elements.brandCre.val();
        let avatarFile = page.dialogs.elements.imageFile[0].files[0];

        let formData = new FormData();
        formData.append("title", title);
        formData.append("price", price);
        formData.append("description", description);
        formData.append("typeId", typeId);
        formData.append("brandId", brandId);
        formData.append("avatarFile", avatarFile);

        $.ajax({
            type: 'POST',
            contentType: false,
            cache: false,
            processData: false,
            url: page.urls.doCreateProductWithAvatar,
            data: formData
        })
            .done((data) => {
                product = data;
                productAvatar = product.productAvatar;
                type = product.type;
                brand = product.brand
                // let str = renderProducts(product, productAvatar, type, brand);
                // $('#tbProduct tbody').prepend(str);
                page.loadData.getAllProduct();

                Swal.fire({
                    position: 'top-end',
                    icon: 'success',
                    title: 'Your work has been saved',
                    showConfirmButton: false,
                    timer: 2000
                })
                page.commands.removeHandleShowModal();
                page.commands.handleShowGroupModal();
                page.dialogs.elements.modalCreateProduct.modal('hide');

            })
            .fail((error) => {
                console.log(error);
            })
    }

    page.commands.handleShowUpdateModal = () => {
        $(".btn_edit").on("click", function () {
            let id = $(this).data("id");
            let avatarFileFolder = $(this).data("avatar-file-folder");
            let avatarFileName = $(this).data("avatar-file-name");
            page.loadData.findProductById(id).done((data) => {

                let avatarUrl = AppBase.API_CLOUDINARY + "/" + AppBase.SCALE_IMAGE_W600_H850_Q100 + "/" + avatarFileFolder + "/" + avatarFileName;
                page.dialogs.commands.loadImageToCanvas(null, "", avatarUrl);
                product = data;
                productAvatar = product.productAvatar;
                page.dialogs.elements.titleUp.val(product.title);
                page.dialogs.elements.priceUp.val(product.price);
                page.dialogs.elements.quantityUp.val(product.quantity);
                page.dialogs.elements.descriptionUp.val(product.description);
                page.dialogs.elements.typeUp.val(product.type.id);
                page.dialogs.elements.brandUp.val(product.brand.id);
                page.dialogs.elements.modalUpdate.modal('show');
            })
        })
    }

    page.dialogs.elements.frmCreateProduct.validate({
        rules: {
            titleCre: {
                required: true,
                minlength: 5,
                maxlength: 50
            },
            PriceCre: {
                required: true,
                min: 100000,
                max: 999999999,
                number: true
            },
            descriptionCre: {
                required: true,
                minlength: 5,
                maxlength: 200
            }
        },
        messages: {
            titleCre: {
                required: "Vui lòng nhập tên sản phẩm.",
                minlength: "Tên sản phẩm có độ dài tối thiểu là 5 ký tự.",
                maxlength: "Tên sản phẩm có độ dài tối đa là 100 ký tự."
            },
            PriceCre: {
                required: "Vui lòng nhập giá.",
                min: "Giá sản phẩm tối thiểu là 100.000 VNĐ.",
                max: "Giá sản phẩm tối đa là 999.999.999 VNĐ.",
                number: "Giá sản phẩm phải là số."
            },
            descriptionCre: {
                required: "Vui lòng nhập mô tả.",
                minlength: "Mô tả có độ dài tối thiểu là 5 ký tự.",
                maxlength: "Mô tả có độ dài tối đa là 200 ký tự."
            }
        },
        submitHandler: function () {
            page.dialogs.commands.doCreate();
        }
    })
    $('#btnCreateCustomer').on('click' , () => {
        $('#frmCreateProduct').trigger('submit');
    })

    page.dialogs.elements.frmUpdate.validate({
        rules: {
            titleUp: {
                required: true,
                minlength: 5,
                maxlength: 50
            },
            priceUp: {
                required: true,
                min: 100000,
                max: 999999999,
                number: true
            },
            quantityUp: {
                required: true,
                min: 1,
                max: 999999,
                number: true
            },
            descriptionUp: {
                required: true,
                minlength: 5,
                maxlength: 200
            }
        },
        messages: {
            titleUp: {
                required: "Vui lòng nhập tên sản phẩm.",
                minlength: "Tên sản phẩm có độ dài tối thiểu là 5 ký tự.",
                maxlength: "Tên sản phẩm có độ dài tối đa là 100 ký tự."
            },
            priceUp: {
                required: "Vui lòng nhập giá.",
                min: "Giá sản phẩm tối thiểu là 100.000 VNĐ.",
                max: "Giá sản phẩm tối đa là 999.999.999 VNĐ.",
                number: "Giá sản phẩm phải là số."
            },
            quantityUp: {
                required: "Vui lòng nhập số lượng.",
                min: "Số lượng tối thiểu là 1 sản phẩm.",
                max: "Số lượng tối thiểu là 999.999 sản phẩm.",
                number: "Số lượng phải là số."
            },
            descriptionUp: {
                required: "Vui lòng nhập mô tả.",
                minlength: "Mô tả có độ dài tối thiểu là 5 ký tự.",
                maxlength: "Mô tả có độ dài tối đa là 200 ký tự."
            }
        },
        submitHandler: function () {

            let title = page.dialogs.elements.titleUp.val();
            let price = page.dialogs.elements.priceUp.val();
            let description = page.dialogs.elements.descriptionUp.val();
            let typeId = page.dialogs.elements.typeUp.val();
            let brandId = page.dialogs.elements.brandUp.val();
            let quantity = page.dialogs.elements.quantityUp.val();

            let avatarFile = page.dialogs.elements.imageFileUp[0].files[0];

            let formData = new FormData();
            formData.append("title", title);
            formData.append("price", price);
            formData.append("description", description);
            formData.append("typeId", typeId);
            formData.append("brandId", brandId);
            formData.append("quantity", quantity);
            formData.append("avatarFile", avatarFile);

            page.commands.doUpdateProduct(formData);
        }
    })
    $('#btnUpdateProduct').on('click' , () => {
        $('#frmUpdateProduct').trigger('submit');
    })

    page.commands.doUpdateProduct = (formData) => {
        $.ajax({
            type: "PATCH",
            contentType: false,
            cache: false,
            processData: false,
            url: "http://localhost:19300/api/products/" + product.id,
            data: formData
        })
            .done((data) => {
                product = data;
                productAvatar = product.productAvatar;
                type = product.type;
                brand = product.brand;
                let str = renderProducts(product, productAvatar, type, brand);
                $('#tr_' + product.id).replaceWith(str);
                page.commands.removeHandleShowModal();
                page.commands.handleShowGroupModal();
                page.dialogs.elements.modalUpdate.modal("hide");

                Swal.fire({
                    icon: 'success',
                    title: 'lưu thành công',
                    showConfirmButton: false,
                    timer: 2000
                })

            }).fail((jqXHR) => {


        })
    }

    page.commands.handleShowConfirmDelete = () => {
        $(".btn_deleted").on("click", function () {
            let id = $(this).data("id");
            // page.loadData.findProductById(id).done((data) =>
            page.loadData.findProductById(id).then(() => {
                Swal.fire({
                    title: 'Bạn có chắc chắn muốn xóa?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Đồng ý!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        page.commands.doDeleteProduct(id);
                    }
                })
            })
        });
    }

    page.commands.doDeleteProduct = (productId) => {
        $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "DELETE",
            url: page.urls.deleteProduct + "/" + productId,
            data: JSON.stringify(productId)
        })
            .done(() => {
                $("#tr_" + productId).remove();
                Swal.fire({
                    icon: 'success',
                    title: 'lưu thành công',
                    showConfirmButton: false,
                    timer: 2000
                })
                page.commands.removeHandleShowModal();
                page.commands.handleShowGroupModal();

            })
            .fail((jqXHR) => {
                if (jqXHR.status === 401) {
                    Swal.fire({
                        icon: 'error',
                        title: '401',
                        showConfirmButton: false,
                        timer: 2000
                    })
                } else {
                    if (jqXHR.status === 403) {
                        Swal.fire({
                            icon: 'error',
                            title: '403',
                            showConfirmButton: false,
                            timer: 2000
                        });
                    } else {
                        if (jqXHR.responseJSON) {
                            console.log(jqXHR.responseJSON.message)
                            Swal.fire({
                                icon: 'error',
                                title: 'xxx',
                                showConfirmButton: false,
                                timer: 2000
                            });;
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: '405',
                                showConfirmButton: false,
                                timer: 2000
                            });;
                        }
                    }
                }
            })
    }

    page.dialogs.commands.loadImageToCanvasUp = (imageFile, fileType, imageUrl) => {
        page.dialogs.elements.imagePreview.css("display", "");
        page.dialogs.elements.wrapper.addClass("active");
        page.dialogs.elements.wrapperContent.css("opacity", 0);

        let imageObj = new Image();

        imageObj.onload = function () {
            page.dialogs.elements.context.canvas.width = imageObj.width;
            page.dialogs.elements.context.canvas.height = imageObj.height;
            page.dialogs.elements.context.drawImage(imageObj, 0, 0, imageObj.width, imageObj.height);
        };
        if (fileType === "BINARY") {
            imageObj.src = URL.createObjectURL(imageFile);
        } else {
            imageObj.src = imageUrl;
        }
    }

    page.dialogs.commands.loadImageToCanvas = (imageFile, fileType, imageUrl) => {
        page.dialogs.elements.imagePreviewCanvas.css("display", "");
        page.dialogs.elements.wrapper.addClass("active");
        page.dialogs.elements.wrapperContent.css("opacity", 0);

        page.dialogs.elements.imagePreviewCanvasUp.css("display", "");
        page.dialogs.elements.wrapper.addClass("active");
        page.dialogs.elements.wrapperContent.css("opacity", 0);

        let imageObj = new Image();

        imageObj.onload = function () {
            page.dialogs.elements.context.canvas.width = imageObj.width;
            page.dialogs.elements.context.canvas.height = imageObj.height;
            page.dialogs.elements.context.drawImage(imageObj, 0, 0, imageObj.width, imageObj.height);

            page.dialogs.elements.contextUp.canvas.width = 445;
            page.dialogs.elements.contextUp.canvas.height = 345;
            page.dialogs.elements.contextUp.drawImage(imageObj, 0, 0, 445, 345);
        };

        if (fileType === "BINARY") {
            imageObj.src = URL.createObjectURL(imageFile);
        }
        else {
            imageObj.src = imageUrl;
        }
    }

    page.dialogs.commands.changeImagePreview = (elem) => {
        let imageFile = elem[0].files[0];

        if (imageFile) {
            let reader = new FileReader();

            reader.readAsDataURL(imageFile);

            reader.onload = function (e) {
                if (e.target.readyState === FileReader.DONE) {
                    page.dialogs.commands.loadImageToCanvas(imageFile, "BINARY", null);
                }
            }
        }
        else {
            page.dialogs.commands.clearImagePreview();
        }
    }

    page.dialogs.commands.clearImagePreview = () => {
        page.dialogs.elements.imageFile.val("");
        page.dialogs.elements.imagePreviewCanvas.css("display", "none");
        page.dialogs.elements.wrapper.removeClass("active");
        page.dialogs.elements.wrapperContent.css("opacity", 1);
    }

    page.loadData.findProductById = (id) => {
        return $.ajax({
            type: 'GET',
            url: page.urls.getProductById + '/' + id
        })
            .done((data) => {

            })
            .fail((error) => {
                console.log(error);
            })
    }

    page.commands.handleShowGroupModal = () => {
        page.commands.handleShowConfirmDelete();
        page.commands.handleShowUpdateModal();
    }

    page.commands.removeHandleShowModal = () => {
        $(".btn_edit").off("click");
        $(".btn_deleted").off("click");
    }

    page.initializeControlEvent = () => {

        page.dialogs.elements.divImagePreview.on('click', () => {
            page.dialogs.elements.imageFile.trigger('click');
        })

        page.dialogs.elements.divFileName.on('click', () => {
            page.dialogs.elements.imageFile.trigger('click');
        })


        page.dialogs.elements.divImagePreviewUp.on('click', () => {
            page.dialogs.elements.imageFileUp.trigger('click');
        })

        // page.dialogs.elements.divImagePreviewUp.on('click', () => {
        //     page.dialogs.elements.imageFile.trigger('click');
        // })
        //
        page.dialogs.elements.divFileNameUp.on('click', () => {
            page.dialogs.elements.imageFileUp.trigger('click');
        })

        page.dialogs.elements.imageFile.on("change", function () {
            page.dialogs.commands.changeImagePreview(page.dialogs.elements.imageFile);
        });

        page.dialogs.elements.imageFileUp.on("change", function () {
            page.dialogs.commands.changeImagePreview(page.dialogs.elements.imageFileUp);
        });

        page.dialogs.elements.btnClearImagePreview.on('click', () => {
            page.dialogs.commands.clearImagePreview();
        })

        page.elements.btnShowCreateModal.on('click', () => {
            $('#frmCreateProduct')[0].reset();
            page.dialogs.elements.modalCreateProduct.modal('show');
        })

    }
    page.commands.renderPagination = (pageable, totalPages) => {
        let str = `
            <li class="page-item disabled">
                <span class="page-link">Previous</span>
            </li>
        `;

        for (let i = 1; i <= totalPages; i++) {
            if ((i - 1) === pageable.pageNumber) {
                str += `
                    <li class="page-item active">
                        <span class="page-link">${i}
                        <span class="sr-only">(current)</span>
                     </span>
                    </li>
                `;
            }
            else {
                str += `
                    <li class="page-item">
                        <button class="page-link" data-page="${i-1}">${i}</button>
                    </li>
                `;
            }
        }

        str += `
            <li class="page-item">
                <a class="page-link" href="#">Next</a>
            </li>
        `;

        return str;
    }
    page.commands.handleAddEventPageLink = () => {
        $('.page-link').on('click', function () {
            let pageNumber = $(this).data('page');
            console.log('pageNumber = ' + pageNumber)
            currentPageNumber = pageNumber;
            page.loadData.getAllProduct();
            // page.commands.doSearch();
        })
    }
    page.commands.renderSearchPagination = (pageable, totalPages) => {
        let str = `
            <li class="page-item disabled">
                <span class="page-link-search">Previous</span>
            </li>
        `;

        for (let i = 1; i <= totalPages; i++) {
            if ((i - 1) === pageable.pageNumber) {
                str += `
                    <li class="page-item active">
                        <span class="page-link-search">${i}
                        <span class="sr-only">(current)</span>
                     </span>
                    </li>
                `;
            }
            else {
                str += `
                    <li class="page-item">
                        <button class="page-link-search" data-page="${i-1}">${i}</button>
                    </li>
                `;
            }
        }

        str += `
            <li class="page-item">
                <a class="page-link-search" href="#">Next</a>
            </li>
        `;

        return str;
    }
    page.commands.handleAddEventSearchPageLink = () => {
        $('.page-link-search').on('click', function () {
            let pageNumber = $(this).data('page');
            console.log('pageNumber = ' + pageNumber)
            currentSearchPageNumber = pageNumber;
            page.loadData.getAllByKeywordDontClick();
            currentSearchPageNumber = 0;
            // page.commands.doSearch();
        })
    }

    var currencyInput = document.querySelector('input[type="currency"]')
    var currency = 'VND' // https://www.currency-iso.org/dam/downloads/lists/list_one.xml

    // format inital value
    onBlur({target:currencyInput})

    // bind event listeners
    currencyInput.addEventListener('focus', onFocus)
    currencyInput.addEventListener('blur', onBlur)


    function localStringToNumber( s ){
        return Number(String(s).replace(/[^0-9.,-]+/g,""))
    }

    function onFocus(e){
        var value = e.target.value;
        e.target.value = value ? localStringToNumber(value) : ' '
    }

    function onBlur(e){
        var value = e.target.value

        var options = {
            maximumFractionDigits : 2,
            currency              : currency,
            style                 : "currency",
            currencyDisplay       : "symbol"
        }

        e.target.value = (value || value === 0)
            ? localStringToNumber(value).toLocaleString(undefined, options)
            : ' '
    }

    $(document).ready(function(){
        $(".type-header").click(function(){
            $(".type-list").toggle("slow","linear");
        });
    });
    $(document).ready(function(){
        $(".brand-header").click(function(){
            $(".brand-list").toggle("slow","linear");
        });
    });
    $(() => {
        page.loadData.getAllProduct();
        page.loadData.getAllByType();
        page.loadData.getAllByBrand();
        page.loadData.getAllByKeyword();
        page.initializeControlEvent();
    })

</script>
</body>
</html>